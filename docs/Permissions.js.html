<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Permissions.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Permissions.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module */
const { User, GuildMember } = require("discord.js");
const Cookieblob = require("./Cookieblob");
 
/**
 * @typedef {Object} PermissionCheckResult
 * @property {Boolean} result
 * @property {?String} comment
 */


const botOwner = module.exports.botOwner = Symbol("botOwner");
const botDeveloper = module.exports.botDeveloper = Symbol("botDeveloper");
const everyone = module.exports.everyone = Symbol("everyone");
const guildMod = module.exports.guildMod = Symbol("guildMod");
const guildAdmin = module.exports.guildAdmin = Symbol("guildAdmin");


/**
 * Is this a valid permission?
 * @param {Symbol} permission 
 * @returns {Boolean}
 */
module.exports.isValidPermission = permission => {
    return permission == botOwner 
    || permission == botDeveloper 
    || permission == everyone 
    || permission == guildAdmin 
    || permission == guildMod;
}


/**
 * Check if a discord user has global permission to do something
 * @param {Cookieblob} cookieblob 
 * @param {User} user
 * @param {Symbol} permission 
 * @returns {Promise&lt;PermissionCheckResult>} has permission?
 */
module.exports.checkGlobal = async (cookieblob, user, permission) => {
    if (permission == everyone) return {result: true};

    if (permission == botDeveloper &amp;&amp; cookieblob.config.developerIDs.includes(user.id)) return {result: true};
    if (permission == botOwner &amp;&amp; user.id == cookieblob.config.ownerID) return {result: true};
    return {result: false};
};
/**
 * Check if a discord member has per-guild permission to do something
 * @param {Cookieblob} cookieblob 
 * @param {GuildMember} member
 * @param {Symbol} permission
 * @returns {Promise&lt;PermissionCheckResult>} 
 */
module.exports.checkGuild = async (cookieblob, member, permission) => {
    if (permission == guildAdmin) return {result: member.hasPermission("ADMINISTRATOR")};
    else if (permission == guildMod) {
        const { r } = cookieblob; // get db
        let gd = await r.table("guildData").get(member.guild.id).run();
        if (!gd || !gd.modRole) return {result: false, comment: "guildNoModrole"};
        return {result: member.roles.has(gd.modRole)};
    }
}

/**
 * Is this a guild or global permission?
 * @param {Symbol} permission 
 * @returns {("global"|"guild")}
 */
module.exports.getPermissionType = permission => {
    const guild = [guildAdmin, guildMod];
    const global = [everyone, botOwner, botDeveloper];
    if (guild.includes(permission)) return "guild";
    else if (global.includes(permission)) return "global";
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Command.html">Command</a></li><li><a href="module-CommandLoader.html">CommandLoader</a></li><li><a href="module-Config.html">Config</a></li><li><a href="module-Cookieblob.html">Cookieblob</a></li><li><a href="module-GuildEvents.html">GuildEvents</a></li><li><a href="module-MessageHandler.html">MessageHandler</a></li><li><a href="module-MusicAlone.html">MusicAlone</a></li><li><a href="module-MusicGuild.html">MusicGuild</a></li><li><a href="module-Permissions.html">Permissions</a></li><li><a href="module-Util.html">Util</a></li></ul><h3>Classes</h3><ul><li><a href="module-Command.html">Command</a></li><li><a href="module-Config.html">Config</a></li><li><a href="module-Cookieblob.html">Cookieblob</a></li><li><a href="module-MusicGuild.html">MusicGuild</a></li></ul><h3>Global</h3><ul><li><a href="global.html#filter">filter</a></li><li><a href="global.html#getSecretFile">getSecretFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Mar 13 2018 20:53:26 GMT+0200 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
