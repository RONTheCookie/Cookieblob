<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: web/web.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: web/web.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const express = require("express");
const Cookieblob = require("../Cookieblob");
const session = require("express-session");
const fs = require("fs");
const Util = require("../Util");
const randomstring = require("randomstring");
/**
 * @param {Cookieblob} cookieblob 
 */
module.exports = async cookieblob => {
    const app = express();
    const httpServer =  require("http").createServer(app);
    app.disable("x-powered-by");
    if (process.env.NODE_ENV == "production") app.set("view engine", "loopback");
    const port = process.env.PORT || 3000;
    app.set("view engine", "ejs");
    httpServer.listen(port);
    console.log(`[web] will listen on port ${port}`);

    app.get("/", (req, res) => {
        res.render("index");
    });
    
    app.get("/invite", (req, res) => {
        res.redirect(`https://discordapp.com/oauth2/authorize?client_id=${cookieblob.user.id}&amp;scope=bot&amp;permissions=3173376`);
    });

    app.get("/docs", (req, res) => {
        res.render("docs", {title: "Docs", commands: Array.from(cookieblob.commands.values()), Util, escapeHTML: require("escape-html")});
    });
    app.get("/stats", (req, res) => {
        res.render("stats", {title: "Stats"});
    });
    app.use("/api", await require("./api")(cookieblob));
    app.use(express.static("static"));
    app.use((req, res) => {
        res.render("error", {error:"404 Page not found.", title: "Error"});
    });
    return {app, httpServer};
};

/** 
 * Gets the secret from the file if it exists, if it does not exist it'll generate a new one.
 * @returns {Promise&lt;String>}
 */
function getSecretFile() {
    return new Promise((resolve, reject) => {
        const fn = "secret.cookieblob";
        fs.exists(fn, exists => {
            if (exists) {
                fs.readFile(fn, (err, data) => {
                    if (err) reject(err);
                    resolve(data);
                });
            } else {
                const secret = randomstring.generate(500); // pretty long secret lol
                fs.writeFile(fn, secret, err => {
                    if (err) reject(err);
                    resolve(secret);
                });
            }
        });
    });
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Command.html">Command</a></li><li><a href="module-CommandLoader.html">CommandLoader</a></li><li><a href="module-Config.html">Config</a></li><li><a href="module-Cookieblob.html">Cookieblob</a></li><li><a href="module-GuildEvents.html">GuildEvents</a></li><li><a href="module-MessageHandler.html">MessageHandler</a></li><li><a href="module-MusicAlone.html">MusicAlone</a></li><li><a href="module-MusicGuild.html">MusicGuild</a></li><li><a href="module-Permissions.html">Permissions</a></li><li><a href="module-Util.html">Util</a></li></ul><h3>Classes</h3><ul><li><a href="module-Command.html">Command</a></li><li><a href="module-Config.html">Config</a></li><li><a href="module-Cookieblob.html">Cookieblob</a></li><li><a href="module-MusicGuild.html">MusicGuild</a></li></ul><h3>Global</h3><ul><li><a href="global.html#filter">filter</a></li><li><a href="global.html#getSecretFile">getSecretFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Mar 13 2018 20:53:26 GMT+0200 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
